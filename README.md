# LSBase - LS증권 비공식 차세대 비동기 API 프레임워크

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

`LSBase`는 LS증권(구 이베스트투자증권) Open API를 더 쉽고, 더 안전하며, 더 Pythonic하게 사용할 수 있도록 설계된 차세대 비동기 프레임워크입니다. 복잡한 API 명세를 **Pydantic 모델로 자동 생성**하고 객체 지향적으로 추상화하여, 개발자가 API 문서의 함정에 빠지지 않고 비즈니스 로직에만 집중할 수 있도록 돕습니다.

## 📜 개요

LS증권 Open API는 강력하지만, 수백 개의 TR 코드와 복잡한 데이터 구조, 미묘한 타입 불일치 등 직접 다루기에는 많은 어려움이 따릅니다. `LSBase`는 이러한 모든 복잡성을 내부적으로 처리하는 강력한 추상화 계층을 제공하며, `asyncio` 기반으로 설계되어 실시간 데이터 처리와 다수의 API 요청을 매우 효율적으로 관리합니다.

## ✨ 주요 특징

-   **🚀 API 모델 자동 생성**: `tools/`의 스크립트를 실행하는 것만으로 최신 API 명세에 맞는 모든 Pydantic 모델을 자동으로 생성합니다. API가 변경되어도 코드 수정 없이 즉시 대응할 수 있습니다.
-   **🔒 강력한 타입 안정성**: 모든 API 요청과 응답 데이터는 Pydantic 모델을 통해 검증됩니다. 이를 통해 서버로 잘못된 요청을 보내거나, 예상치 못한 응답을 받는 경우를 사전에 차단하여 런타임 오류를 획기적으로 줄여줍니다.
-   **⚡ 완전 비동기 처리**: `asyncio`와 `aiohttp`를 기반으로 설계되어 I/O 병목 현상 없이 빠르고 효율적인 API 요청 및 실시간 데이터 처리가 가능합니다.
-   **🧩 포괄적인 주식 시장 기능**:
    -   **주문**: 지정가/시장가 주문 (`place_order`), 정정 (`modify_order`), 취소 (`cancel_order`)
    -   **계좌**: 예수금 및 잔고 조회 (`get_account_balance`), 보유 종목 포트폴리오 조회 (`get_portfolio`)
    -   **시세**: 현재가 조회 (`get_quote`), 시가총액 상위 조회 (`get_top_market_cap_stocks`)
    -   **실시간 처리**: 주문 접수, 체결, 정정, 취소 등 실시간 주문 상태 수신
-   **🔄 자동 연속 조회**: 여러 페이지에 걸쳐 데이터를 요청해야 하는 경우, 프레임워크가 복잡한 연속 조회 로직을 자동으로 처리합니다.
-   **🔐 간편한 환경 설정**: `.env` 파일을 통해 API 키와 계좌 정보를 안전하고 쉽게 관리할 수 있습니다.

## 🏁 시작하기

### 사전 준비

1.  **Python 3.8 이상**
2.  LS증권 Open API 사용 신청 후 **APP KEY**와 **APP SECRET** 발급
3.  모의투자 또는 실제 투자 계좌 정보

### 설치 및 설정

1.  **프로젝트 클론**
    ```bash
    git clone https://github.com/your-username/LSBase.git
    cd LSBase
    ```

2.  **가상 환경 생성 및 활성화 (권장)**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Windows: venv\Scripts\activate
    ```

3.  **필요한 라이브러리 설치**
    ```bash
    pip install -r requirements.txt
    ```

4.  **환경 변수 설정**
    프로젝트 루트에 `.env` 파일을 생성하고 자신의 정보를 입력하세요.
    ```env
    # .env
    APP_KEY="여기에_발급받은_APP_KEY를_입력하세요"
    APP_SECRET="여기에_발급받은_APP_SECRET을_입력하세요"
    ACCOUNT_NO="계좌번호_앞_8자리"
    ACCOUNT_PASSWORD="계좌_비밀번호"
    ```

5.  **(최초 1회 필수) API 모델 생성**
    `LSBase`는 API 명세에 기반한 모델 파일을 필요로 합니다. 아래 스크립트를 실행하여 최신 명세 파일을 다운로드하고, 이를 기반으로 `lsbase/generated_models.py` 파일을 생성하세요.
    ```bash
    # tools 디렉토리로 이동
    cd lsbase/tools
    
    # 1. 최신 API 명세 스크레이핑 (시간이 다소 소요될 수 있습니다)
    python update_api_specs.py full

    # 2. Pydantic 모델 파일 생성
    python generate_code.py

    # 3. 프로젝트 루트로 복귀
    cd ../..
    ```
    *LS증권 API가 업데이트될 경우, 이 과정만 반복하면 라이브러리를 최신 상태로 유지할 수 있습니다.*

## 🚀 사용법 예제

### `full_order_cycle.py`: 주문 전체 사이클 테스트

이 예제는 `LSBase`의 핵심 기능을 모두 사용하여 **[지정가 주문 → 정정 → 취소 → 시장가 체결]** 의 전체 시나리오를 실행하고, 모든 과정에서 발생하는 실시간 주문 상태를 수신하여 출력합니다.

**실행:**
```bash
python full_order_cycle.py
```

**예상 출력:**
```
실시간 주문 상태 수신을 시작합니다. (계좌: ...)

--- [1/4] 90,000원에 지정가 매수 주문 요청 ---
✅ 초기 주문 요청 성공! (주문번호: 12581)

======================================
📢 [실시간 주문 상태 수신]
   - 상태: 주문접수 (SC0)
   - 주문번호: 12581
======================================

--- [2/4] 주문번호 12581을 92,000원으로 정정 요청 ---
✅ 주문 정정 요청 성공! (새 주문번호: 12583)

======================================
📢 [실시간 주문 상태 수신]
   - 상태: 주문정정 (SC2)
   - 주문번호: 12583
======================================

... (이후 취소, 시장가 주문, 체결 과정이 순차적으로 출력됩니다) ...```

## 📂 프로젝트 구조

```
LSBase/
├── lsbase/
│   ├── api_client/          # API 클라이언트 구현체
│   ├── core/                # 핵심 인터페이스, 모델, 예외 정의
│   ├── markets/             # 주식, 선물 등 시장별 기능 구현
│   ├── openapi_client/      # 저수준 OpenApi 래퍼 클래스
│   ├── tools/               # 🚀 API 모델 자동 생성 도구
│   └── generated_models.py  # (자동 생성) 모든 TR의 Pydantic 모델
├── examples/                # 사용법 예제 스크립트 모음
├── .env                     # (사용자 생성) API 키 등 민감 정보
├── requirements.txt         # 의존성 라이브러리 목록
└── README.md
```

## 🔮 향후 계획

-   [ ] **선물/옵션 시장 지원**: `FuturesMarket` 클래스 구현
-   [ ] **종합적인 오류 처리**: API 오류 코드에 따른 구체적인 예외 처리 및 재시도 로직 강화
-   [ ] **단위 테스트 및 통합 테스트**: 코드 안정성 확보를 위한 테스트 케이스 작성
-   [ ] **문서화**: 각 모듈과 클래스에 대한 상세한 Sphinx/MkDocs 문서 작성
-   [ ] **배포**: PyPI 패키지로 배포하여 `pip install lsbase`로 설치 가능하도록 지원

## 📄 라이선스

이 프로젝트는 [MIT 라이선스](LICENSE.md)를 따릅니다.
