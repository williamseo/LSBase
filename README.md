# LSBase - LS증권 비공식 비동기 API 프레임워크

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

`LSBase`는 LS증권(구 이베스트투자증권)에서 제공하는 Open API를 더 쉽고 직관적으로 사용할 수 있도록 설계된 Python 비동기(Asynchronous) 프레임워크입니다. 복잡한 API 명세를 객체 지향적인 구조로 추상화하여, 개발자가 비즈니스 로직에만 집중할 수 있도록 돕는 것을 목표로 합니다.

## 📜 개요

LS증권 Open API는 강력한 기능을 제공하지만, TR 코드, 요청 헤더, 연속성 조회 등 직접 사용하기에는 다소 복잡한 부분들이 있습니다. `LSBase`는 이러한 복잡성을 내부적으로 처리하는 추상화 계층을 제공합니다. `asyncio`를 기반으로 설계되어 실시간 데이터 처리와 다수의 API 요청을 효율적으로 관리할 수 있습니다.

## ✨ 주요 특징

-   **비동기 처리**: `asyncio`를 사용하여 I/O 병목 현상 없이 빠르고 효율적인 API 요청 및 데이터 처리가 가능합니다.
-   **객체 지향 설계**: `MarketClient`를 통해 주식(`stock`), 선물옵션(`futures`) 등 각 시장에 특화된 기능을 명확하게 분리하여 사용할 수 있습니다.
-   **자동 연속 조회 처리**: 시가총액 상위 종목 조회(`get_top_market_cap_stocks`)와 같이 여러 페이지에 걸쳐 데이터를 요청해야 하는 경우, 복잡한 연속 조회 로직을 프레임워크가 자동으로 처리합니다.
-   **쉬운 환경 설정**: `.env` 파일을 통해 API 키와 계좌 정보를 안전하고 간편하게 관리할 수 있습니다.
-   **확장 가능한 구조**: `core` 디렉터리의 인터페이스(`TradingAPI`, `MarketBase`)를 기반으로 새로운 시장이나 기능을 쉽게 추가할 수 있도록 설계되었습니다.

## 🏁 시작하기

### 사전 준비

1.  **Python 3.8 이상**이 설치되어 있어야 합니다.
2.  LS증권 Open API 사용 신청 후 **APP KEY**와 **APP SECRET**을 발급받아야 합니다.
3.  주문 관련 기능을 사용하려면 모의투자 또는 실제 투자 계좌 정보가 필요합니다.

### 설치 및 설정

1.  **프로젝트 클론**
    ```bash
    git clone https://github.com/your-username/LSBase.git
    cd LSBase
    ```

2.  **가상 환경 생성 및 활성화 (권장)**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Windows: venv\Scripts\activate
    ```

3.  **필요한 라이브러리 설치**
    `requirements.txt` 파일에 아래 내용을 추가하고 설치하세요.
    ```
    aiohttp
    python-dotenv
    pytz
    ```
    ```bash
    pip install -r requirements.txt
    ```

4.  **환경 변수 설정**
    프로젝트의 루트 디렉터리에 `.env` 파일을 생성하고 아래 내용에 맞게 자신의 정보를 입력하세요.
    ```env
    # .env

    # LS Securities API
    APP_KEY="여기에_발급받은_APP_KEY를_입력하세요"
    APP_SECRET="여기에_발급받은_APP_SECRET을_입력하세요"

    # LS Securities Account (주문/계좌 조회 시 필요)
    ACCOUNT_NO="계좌번호_앞_8자리"
    ACCOUNT_PASSWORD="계좌_비밀번호"
    ```

## 🚀 사용법

프로젝트에 포함된 예제 코드를 통해 `LSBase`의 기본적인 사용법을 확인할 수 있습니다.

### 예제 1: 단일 종목 현재가 조회

`sample_get_price.py`는 특정 종목(예: 삼성전자)의 현재가, 종목명, 거래량 등 시세 정보를 조회합니다.

**실행:**
```bash
python sample_get_price.py
```

**예상 출력:**
```
API 서버에 연결을 시도합니다...
연결 성공.

'005930'의 현재가 조회를 요청합니다...

--- 조회 결과 ---
종목명: 삼성전자
현재가: 82,600 원
거래량: 15,350,123 주
-----------------
API 연결을 종료합니다.
```

### 예제 2: 시가총액 상위 종목 조회

`sample_get_top_stocks.py`는 프레임워크의 자동 연속 조회 기능을 사용하여 KOSPI와 KOSDAQ의 시가총액 상위 100개 종목 리스트를 가져옵니다.

**실행:**
```bash
python sample_get_top_stocks.py
```

**예상 출력:**
```
API 서버에 연결을 시도합니다...
연결 성공.

KOSPI 시가총액 상위 종목 조회를 시작합니다 (최대: 100)...
현재까지 50개 종목 수집 완료...
현재까지 100개 종목 수집 완료...
총 100개의 KOSPI 종목 조회를 완료했습니다.

========================= KOSPI 시가총액 Top 100 (총 100개) =========================
    순위 | 종목명             | 종목코드     |      현재가 (원) |      시가총액 (억 원)
--------------------------------------------------------------------------------
     1 | 삼성전자            | 005930     |         82,600 |       4,930,879
     2 | SK하이닉스          | 000660     |        222,500 |       1,619,621
... (중략) ...
    99 | 롯데케미칼          | 011170     |        130,000 |          19,200
   100 | 현대오토에버        | 307950     |        160,000 |          19,000
================================================================================

(이어서 KOSDAQ 결과 출력)
```

## 📂 프로젝트 구조

```
LSBase/
├── lsbase/                  # 핵심 프레임워크 소스 코드
│   ├── api_client/          # API 클라이언트 구현체
│   ├── core/                # 핵심 인터페이스, 모델, 열거형 정의
│   ├── markets/             # 주식, 선물 등 시장별 기능 구현
│   └── openapi_client/      # 저수준 OpenApi 래퍼 클래스
├── sample_get_price.py      # 예제 1: 단일 종목 조회
├── sample_get_top_stocks.py # 예제 2: 시가총액 상위 종목 조회
├── .env                     # (사용자 생성) API 키 등 민감 정보
├── requirements.txt         # (사용자 생성) 의존성 라이브러리 목록
└── README.md                # 프로젝트 소개 문서
```

## 🔮 향후 계획

-   [ ] **주문 기능 구현**: `place_order`, `modify_order`, `cancel_order` 메서드 구현
-   [ ] **실시간 데이터 처리**: WebSocket을 통한 실시간 시세 및 체결 데이터 수신 기능 구체화
-   [ ] **선물/옵션 시장 지원**: `FuturesMarket` 클래스 구현
-   [ ] **종합적인 오류 처리**: API 오류 코드에 따른 예외 처리 및 재시도 로직 강화
-   [ ] **단위 테스트 및 문서화**: 코드 안정성 확보 및 개발자 문서 작성

## 📄 라이선스

이 프로젝트는 [MIT 라이선스](LICENSE.md)를 따릅니다.
